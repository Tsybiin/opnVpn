#!/bin/bash
EXPECT_TEXT="Enter pass phrase for /etc/openvpn/pki/private/ca.key:"
#echo $@
#echo $2
yess='yes\n'
password='7498'
cd ~/www/opnVpn/keys/new
echo "Переданные аргументы:"
echo "$exShow"
for arg in "$@"; do
  echo "$arg"
  COMMSHOW="
      set timeout 2
      # shellcheck disable=SC2089
      spawn  docker-compose run --rm openvpn1 ovpn_revokeclient $arg
      expect \"Continue with revocation:\"
      send \"$yess\"
      expect \"Enter pass phrase for /etc/openvpn/pki/private/ca.key:\"
      send \"$password\n\"
      expect \"Enter pass phrase for /etc/openvpn/pki/private/ca.key:\"
      send \"$password\n\"
      expect \"An updated CRL has been created.\"
      send \"done\"
  expect eof "
expect -c "$COMMSHOW"
rm $arg.ovpn
echo "key user $arg delete"

done




#cd /etc/openvpn/easy-rsa
#NAME=$1
#EXPECT_TEXT_CONFIRM="Continue with revocation:"
#EXPECT_TEXT_PASSWORD="Continue with revocation:"
#CONFIRM="yes\n"
## TODO пароль вводитьь в консоли
#password="7498\n"
##create key
#DELETE_KEY="
#    set timeout 1
#    spawn ./easyrsa revoke $NAME
#    expect \"$EXPECT_TEXT_CONFIRM\"
#    send \"$CONFIRM\"
#    expect \"$EXPECT_TEXT_PASSWORD\"
#    send \"$password\"
#expect eof"
#
#expect -c "$DELETE_KEY"
#
#echo "syart del"
#
## TODO добавить обновление ./easyrsa gen-crl
#
#
#
## delete key
#if [ -f /etc/openvpn/easy-rsa/pki/issued/$NAME.crt ]
#then
#  echo "error"
#else
# rm -R /home/tsybin/keysVpn/$NAME
# echo "key user $NAME delete"
##fi
#
#
#
#
#














